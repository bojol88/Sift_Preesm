/** 
 * @file Core2.c
 * @generated by CPrinter
 * @date Sun May 03 18:06:14 CEST 2015
 */

#include "../include/x86.h"

// Core Global Declaration
extern pthread_barrier_t iter_barrier;
extern int stopThreads;
extern char SharedMem[58253416]; //  size:= 58253416*char
extern int *const init_out__in__1;  // octavesH_init_in_init_out > octavesH_in size:= 6*int defined in Core0
extern int *const out1__octavesH__0;  // octavesH_out1 > BuildOB_octavesH size:= 6*int defined in Core0
extern int *const out2__octavesH__0;  // octavesH_out2 > BuildSS_octavesH size:= 6*int defined in Core0
extern int *const out3__octavesH__0;  // octavesH_out3 > DoG_octavesH size:= 6*int defined in Core0
extern int *const out4__octavesH__0;  // octavesH_out4 > Extreme_octavesH size:= 6*int defined in Core0
extern int *const out5__end_in__0;  // octavesH_out5 > octavesH_end_out5_end_in size:= 6*int defined in Core0
extern char *const octavesH__octavesH_end_out5__0;  // octavesH > octavesH_end_out5 size:= 24*char defined in Core0
extern char *const octavesW__Orientation__0;  // octavesW > Orientation size:= 24*char defined in Core0
extern sem_t sem_6_SSRE; 
extern char *const octavesW__Extreme__0;  // octavesW > Extreme size:= 24*char defined in Core0
extern sem_t sem_7_SSRE; 
extern char *const octavesW__DoG__0;  // octavesW > DoG size:= 24*char defined in Core0
extern sem_t sem_8_SSRE; 
extern char *const octavesW__BuildSS__0;  // octavesW > BuildSS size:= 24*char defined in Core0
extern sem_t sem_9_SSRE; 
extern char *const octavesW__BuildOB__0;  // octavesW > BuildOB size:= 24*char defined in Core0
extern sem_t sem_10_SSRE; 
extern char *const sigmas__Orientation__0;  // sigmas > Orientation size:= 144*char defined in Core0
extern sem_t sem_12_SSRE; 
extern char *const sigmas__BuildSS__0;  // sigmas > BuildSS size:= 144*char defined in Core0
extern sem_t sem_13_SSRE; 
extern char *const Img__BuildOB__0;  // Img > BuildOB size:= 101376*char defined in Core0
extern sem_t sem_14_SSRE; 
extern uchar *const out1__img__0;  // Img_out1 > BuildOB_img size:= 101376*uchar defined in Core0
extern uchar *const octaves__octaves__0;  // BuildOB_octaves > BuildSS_octaves size:= 608256*uchar defined in Core0
extern int *const out1__octavesW__0;  // octavesW_out1 > BuildOB_octavesW size:= 6*int defined in Core0
extern float *const scaleSpace__in__0;  // BuildSS_scaleSpace > scaleSpace_in size:= 3649536*float defined in Core0
extern int *const out2__octavesW__0;  // octavesW_out2 > BuildSS_octavesW size:= 6*int defined in Core0
extern float *const out1__sigmas__0;  // sigmas_out1 > BuildSS_sigmas size:= 36*float defined in Core0
extern float *const out1__scaleSpace__0;  // scaleSpace_out1 > DoG_scaleSpace size:= 3649536*float defined in Core0
extern float *const out2__scaleSpace__0;  // scaleSpace_out2 > Orientation_scaleSpace size:= 3649536*float defined in Core0
extern float *const dog__dog__0;  // DoG_dog > Extreme_dog size:= 3041280*float defined in Core0
extern int *const out3__octavesW__0;  // octavesW_out3 > DoG_octavesW size:= 6*int defined in Core0
extern pointList *const keyPointList__keyPointList__0;  // Extreme_keyPointList > Orientation_keyPointList size:= 1*pointList defined in Core0
extern int *const out4__octavesW__0;  // octavesW_out4 > Extreme_octavesW size:= 6*int defined in Core0
extern pointList *const keyPointListCP__end_in__0;  // Orientation_keyPointListCP > Orientation_end_keyPointListCP_end_in size:= 1*pointList defined in Core0
extern float *const out2__sigmas__0;  // sigmas_out2 > Orientation_sigmas size:= 36*float defined in Core0
extern int *const out5__octavesW__0;  // octavesW_out5 > Orientation_octavesW size:= 6*int defined in Core0
extern char *const FIFO_Head_Orientation_end_ke__0;  // FIFO_Head_Orientation_end_keyPointListCP > Render_init_keyPointList size:= 12004*char defined in Core3

// Core Global Definitions
char *const FIFO_Head_Init_end_octavesH___0 = (char*) (SharedMem+43452424);  // FIFO_Head_Init_end_octavesH_g > octavesH_init_in size:= 24*char
sem_t sem_4_SSRE;

void *computationThread_Core2(void *arg){
	// Initialisation(s)
	fifoInit(FIFO_Head_Init_end_octavesH___0, 24*sizeof(char), NULL, 0);
	sem_init(&sem_4_SSRE,0,0/*init_val*/); // octavesH > octavesH_end_out5

	// Begin the execution loop 
	while(1){
		pthread_barrier_wait(&iter_barrier);
		if(stopThreads){
			pthread_exit(NULL);
		}
		fifoPop(init_out__in__1, FIFO_Head_Init_end_octavesH___0, 24*sizeof(char), NULL, 0);
		// Broadcast octavesH
		{
			memcpy(out1__octavesH__0+0, init_out__in__1+0, 6*sizeof(int));
			memcpy(out2__octavesH__0+0, init_out__in__1+0, 6*sizeof(int));
			memcpy(out3__octavesH__0+0, init_out__in__1+0, 6*sizeof(int));
			memcpy(out4__octavesH__0+0, init_out__in__1+0, 6*sizeof(int));
			memcpy(out5__end_in__0+0, init_out__in__1+0, 6*sizeof(int));
		}
		sendStart(&sem_4_SSRE/*ID*/); // Core2 > Core3: octavesH__octavesH_end_out5__0 
		sendEnd(); // Core2 > Core3: octavesH__octavesH_end_out5__0 
		receiveStart(); // Core0 > Core2: octavesW__Orientation__0 
		receiveEnd(&sem_6_SSRE/*ID*/); // Core0 > Core2: octavesW__Orientation__0 
		receiveStart(); // Core0 > Core2: octavesW__Extreme__0 
		receiveEnd(&sem_7_SSRE/*ID*/); // Core0 > Core2: octavesW__Extreme__0 
		receiveStart(); // Core0 > Core2: octavesW__DoG__0 
		receiveEnd(&sem_8_SSRE/*ID*/); // Core0 > Core2: octavesW__DoG__0 
		receiveStart(); // Core0 > Core2: octavesW__BuildSS__0 
		receiveEnd(&sem_9_SSRE/*ID*/); // Core0 > Core2: octavesW__BuildSS__0 
		receiveStart(); // Core0 > Core2: octavesW__BuildOB__0 
		receiveEnd(&sem_10_SSRE/*ID*/); // Core0 > Core2: octavesW__BuildOB__0 
		receiveStart(); // Core1 > Core2: sigmas__Orientation__0 
		receiveEnd(&sem_12_SSRE/*ID*/); // Core1 > Core2: sigmas__Orientation__0 
		receiveStart(); // Core1 > Core2: sigmas__BuildSS__0 
		receiveEnd(&sem_13_SSRE/*ID*/); // Core1 > Core2: sigmas__BuildSS__0 
		receiveStart(); // Core3 > Core2: Img__BuildOB__0 
		receiveEnd(&sem_14_SSRE/*ID*/); // Core3 > Core2: Img__BuildOB__0 
		buildOB(out1__img__0,octaves__octaves__0,out1__octavesW__0,out1__octavesH__0); // BuildOB
		buildSS(octaves__octaves__0,scaleSpace__in__0,out2__octavesW__0,out2__octavesH__0,out1__sigmas__0); // BuildSS
		// Broadcast scaleSpace
		{
			memcpy(out1__scaleSpace__0+0, scaleSpace__in__0+0, 3649536*sizeof(float));
			memcpy(out2__scaleSpace__0+0, scaleSpace__in__0+0, 3649536*sizeof(float));
		}
		DoG(dog__dog__0,out1__scaleSpace__0,out3__octavesW__0,out3__octavesH__0); // DoG
		extreme(keyPointList__keyPointList__0,dog__dog__0,out4__octavesW__0,out4__octavesH__0); // Extreme
		orientation(keyPointList__keyPointList__0,keyPointListCP__end_in__0,out2__scaleSpace__0,out2__sigmas__0,out5__octavesW__0); // Orientation
		fifoPush(keyPointListCP__end_in__0, FIFO_Head_Orientation_end_ke__0, 12004*sizeof(char), NULL, 0);
	}
}
