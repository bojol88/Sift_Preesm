/** 
 * @file Core3.c
 * @generated by CPrinter
 * @date Sun May 03 22:33:32 CEST 2015
 */

#include "../include/x86.h"

// Core Global Declaration
extern pthread_barrier_t iter_barrier;
extern int stopThreads;
extern char SharedMem[89186408]; //  size:= 89186408*char
extern uchar *const init_out__octaves__0;  // BuildSS_init_octaves_init_out > BuildSS_octaves size:= 608256*uchar defined in Core0
extern float *const init_out__in__1;  // scaleSpace_init_in_init_out > scaleSpace_in size:= 3649536*float defined in Core0
extern char *const scaleSpace_init_in__scaleSpa__0;  // scaleSpace_init_in > scaleSpace size:= 14598144*char defined in Core0
extern char *const octavesH__BuildSS__0;  // octavesH > BuildSS size:= 24*char defined in Core0
extern sem_t sem_6_SSRE; 
extern char *const octavesW__BuildSS__0;  // octavesW > BuildSS size:= 24*char defined in Core0
extern sem_t sem_11_SSRE; 
extern char *const sigmas__BuildSS__0;  // sigmas > BuildSS size:= 144*char defined in Core0
extern sem_t sem_13_SSRE; 
extern float *const scaleSpace__end_in__0;  // BuildSS_scaleSpace > BuildSS_end_scaleSpace_end_in size:= 3649536*float defined in Core0
extern int *const out2__octavesW__0;  // octavesW_out2 > BuildSS_octavesW size:= 6*int defined in Core0
extern int *const out2__octavesH__0;  // octavesH_out2 > BuildSS_octavesH size:= 6*int defined in Core0
extern float *const out1__sigmas__0;  // sigmas_out1 > BuildSS_sigmas size:= 36*float defined in Core0

// Core Global Definitions
char *const FIFO_Head_BuildOB_end_octave__0 = (char*) (SharedMem+42882624);  // FIFO_Head_BuildOB_end_octaves > BuildSS_init_octaves size:= 608256*char
char *const FIFO_Head_BuildSS_end_scaleS__0 = (char*) (SharedMem+43646736);  // FIFO_Head_BuildSS_end_scaleSpace > scaleSpace_init_in size:= 14598144*char
sem_t sem_2_SSRE;

void *computationThread_Core3(void *arg){
	// Initialisation(s)
	fifoInit(FIFO_Head_BuildOB_end_octave__0, 608256*sizeof(char), NULL, 0);
	fifoInit(FIFO_Head_BuildSS_end_scaleS__0, 14598144*sizeof(char), NULL, 0);
	sem_init(&sem_2_SSRE,0,0/*init_val*/); // scaleSpace_init_in > scaleSpace

	// Begin the execution loop 
	while(1){
		pthread_barrier_wait(&iter_barrier);
		if(stopThreads){
			pthread_exit(NULL);
		}
		fifoPop(init_out__octaves__0, FIFO_Head_BuildOB_end_octave__0, 608256*sizeof(char), NULL, 0);
		fifoPop(init_out__in__1, FIFO_Head_BuildSS_end_scaleS__0, 14598144*sizeof(char), NULL, 0);
		sendStart(&sem_2_SSRE/*ID*/); // Core3 > Core0: scaleSpace_init_in__scaleSpa__0 
		sendEnd(); // Core3 > Core0: scaleSpace_init_in__scaleSpa__0 
		receiveStart(); // Core2 > Core3: octavesH__BuildSS__0 
		receiveEnd(&sem_6_SSRE/*ID*/); // Core2 > Core3: octavesH__BuildSS__0 
		receiveStart(); // Core1 > Core3: octavesW__BuildSS__0 
		receiveEnd(&sem_11_SSRE/*ID*/); // Core1 > Core3: octavesW__BuildSS__0 
		receiveStart(); // Core0 > Core3: sigmas__BuildSS__0 
		receiveEnd(&sem_13_SSRE/*ID*/); // Core0 > Core3: sigmas__BuildSS__0 
		buildSS(init_out__octaves__0,scaleSpace__end_in__0,out2__octavesW__0,out2__octavesH__0,out1__sigmas__0); // BuildSS
		fifoPush(scaleSpace__end_in__0, FIFO_Head_BuildSS_end_scaleS__0, 14598144*sizeof(char), NULL, 0);
	}
}
