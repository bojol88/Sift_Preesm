/** 
 * @file Core3.c
 * @generated by CPrinter
 * @date Sun May 03 18:06:14 CEST 2015
 */

#include "../include/x86.h"

// Core Global Declaration
extern pthread_barrier_t iter_barrier;
extern int stopThreads;
extern char SharedMem[58253416]; //  size:= 58253416*char
extern uchar *const init_out__in__0;  // Img_init_in_init_out > Img_in size:= 101376*uchar defined in Core0
extern int *const octavesW_g__end_in__0;  // Init_octavesW_g > Init_end_octavesW_g_end_in size:= 6*int defined in Core0
extern int *const octavesH_g__end_in__0;  // Init_octavesH_g > Init_end_octavesH_g_end_in size:= 6*int defined in Core0
extern float *const sigmas__end_in__0;  // Init_sigmas > Init_end_sigmas_end_in size:= 36*float defined in Core0
extern uchar *const y__end_in__0;  // ReadYUV_y > ReadYUV_end_y_end_in size:= 101376*uchar defined in Core0
extern pointList *const init_out__keyPointList__0;  // Render_init_keyPointList_init_out > Render_keyPointList size:= 1*pointList defined in Core0
extern char *const Render_init_keyPointList__Re__0;  // Render_init_keyPointList > Render size:= 12004*char defined in Core0
extern int *const init_out__octavesH__0;  // Render_init_octavesH_init_out > Render_octavesH size:= 6*int defined in Core0
extern char *const Render_init_octavesH__Render__0;  // Render_init_octavesH > Render size:= 24*char defined in Core0
extern char *const octavesH__octavesH_end_out5__0;  // octavesH > octavesH_end_out5 size:= 24*char defined in Core0
extern sem_t sem_4_SSRE; 
extern char *const octavesW__octavesW_end_out6__0;  // octavesW > octavesW_end_out6 size:= 24*char defined in Core0
extern sem_t sem_5_SSRE; 
extern char *const sigmas__sigmas_end_out3__0;  // sigmas > sigmas_end_out3 size:= 144*char defined in Core0
extern sem_t sem_11_SSRE; 
extern int *const out5__end_in__0;  // octavesH_out5 > octavesH_end_out5_end_in size:= 6*int defined in Core0
extern char *const FIFO_Head_octavesW_end_out6___0;  // FIFO_Head_octavesW_end_out6 > Render_init_octavesW size:= 24*char defined in Core0
extern int *const out6__end_in__0;  // octavesW_out6 > octavesW_end_out6_end_in size:= 6*int defined in Core0
extern char *const FIFO_Head_sigmas_end_out3__R__0;  // FIFO_Head_sigmas_end_out3 > Render_init_sigmas size:= 144*char defined in Core0
extern float *const out3__end_in__0;  // sigmas_out3 > sigmas_end_out3_end_in size:= 36*float defined in Core0
extern char *const FIFO_Head_Init_end_octavesH___0;  // FIFO_Head_Init_end_octavesH_g > octavesH_init_in size:= 24*char defined in Core2
extern char *const FIFO_Head_Init_end_octavesW___0;  // FIFO_Head_Init_end_octavesW_g > octavesW_init_in size:= 24*char defined in Core0
extern char *const FIFO_Head_Init_end_sigmas__s__0;  // FIFO_Head_Init_end_sigmas > sigmas_init_in size:= 144*char defined in Core1
extern uchar *const out1__img__0;  // Img_out1 > BuildOB_img size:= 101376*uchar defined in Core0
extern uchar *const out2__end_in__0;  // Img_out2 > Img_end_out2_end_in size:= 101376*uchar defined in Core0
extern char *const Img__BuildOB__0;  // Img > BuildOB size:= 101376*char defined in Core0
extern char *const Render__Render_end_g__0;  // Render > Render_end_g size:= 101376*char defined in Core0
extern sem_t sem_15_SSRE; 
extern char *const FIFO_Head_Img_end_out2__Rend__0;  // FIFO_Head_Img_end_out2 > Render_init_img size:= 101376*char defined in Core0
extern char *const FIFO_Head_Render_end_g__Writ__0;  // FIFO_Head_Render_end_g > WritePGM_init_g size:= 101376*char defined in Core1
extern uchar *const g__end_in__0;  // Render_g > Render_end_g_end_in size:= 101376*uchar defined in Core0

// Core Global Definitions
char *const FIFO_Head_ReadYUV_end_y__Img__0 = (char*) (SharedMem+43351048);  // FIFO_Head_ReadYUV_end_y > Img_init_in size:= 101376*char
char *const FIFO_Head_Orientation_end_ke__0 = (char*) (SharedMem+28005332);  // FIFO_Head_Orientation_end_keyPointListCP > Render_init_keyPointList size:= 12004*char
sem_t sem_0_SSRE;
char *const FIFO_Head_octavesH_end_out5___0 = (char*) (SharedMem+27675792);  // FIFO_Head_octavesH_end_out5 > Render_init_octavesH size:= 24*char
sem_t sem_1_SSRE;
sem_t sem_14_SSRE;

void *computationThread_Core3(void *arg){
	// Initialisation(s)
	fifoInit(FIFO_Head_ReadYUV_end_y__Img__0, 101376*sizeof(char), NULL, 0);
	initReadYUV(352/*xsize*/,288/*ysize*/); // ReadYUV
	fifoInit(FIFO_Head_Orientation_end_ke__0, 12004*sizeof(char), NULL, 0);
	sem_init(&sem_0_SSRE,0,0/*init_val*/); // Render_init_keyPointList > Render
	fifoInit(FIFO_Head_octavesH_end_out5___0, 24*sizeof(char), NULL, 0);
	sem_init(&sem_1_SSRE,0,0/*init_val*/); // Render_init_octavesH > Render
	sem_init(&sem_14_SSRE,0,0/*init_val*/); // Img > BuildOB

	// Begin the execution loop 
	while(1){
		pthread_barrier_wait(&iter_barrier);
		if(stopThreads){
			pthread_exit(NULL);
		}
		fifoPop(init_out__in__0, FIFO_Head_ReadYUV_end_y__Img__0, 101376*sizeof(char), NULL, 0);
		InitSift(352/*xsize*/,288/*ysize*/,octavesW_g__end_in__0,octavesH_g__end_in__0,sigmas__end_in__0); // Init
		readYUV(352/*xsize*/,288/*ysize*/,y__end_in__0); // ReadYUV
		fifoPop(init_out__keyPointList__0, FIFO_Head_Orientation_end_ke__0, 12004*sizeof(char), NULL, 0);
		sendStart(&sem_0_SSRE/*ID*/); // Core3 > Core0: Render_init_keyPointList__Re__0 
		sendEnd(); // Core3 > Core0: Render_init_keyPointList__Re__0 
		fifoPop(init_out__octavesH__0, FIFO_Head_octavesH_end_out5___0, 24*sizeof(char), NULL, 0);
		sendStart(&sem_1_SSRE/*ID*/); // Core3 > Core0: Render_init_octavesH__Render__0 
		sendEnd(); // Core3 > Core0: Render_init_octavesH__Render__0 
		receiveStart(); // Core2 > Core3: octavesH__octavesH_end_out5__0 
		receiveEnd(&sem_4_SSRE/*ID*/); // Core2 > Core3: octavesH__octavesH_end_out5__0 
		receiveStart(); // Core0 > Core3: octavesW__octavesW_end_out6__0 
		receiveEnd(&sem_5_SSRE/*ID*/); // Core0 > Core3: octavesW__octavesW_end_out6__0 
		receiveStart(); // Core1 > Core3: sigmas__sigmas_end_out3__0 
		receiveEnd(&sem_11_SSRE/*ID*/); // Core1 > Core3: sigmas__sigmas_end_out3__0 
		fifoPush(out5__end_in__0, FIFO_Head_octavesH_end_out5___0, 24*sizeof(char), NULL, 0);
		fifoPush(out6__end_in__0, FIFO_Head_octavesW_end_out6___0, 24*sizeof(char), NULL, 0);
		fifoPush(out3__end_in__0, FIFO_Head_sigmas_end_out3__R__0, 144*sizeof(char), NULL, 0);
		fifoPush(octavesH_g__end_in__0, FIFO_Head_Init_end_octavesH___0, 24*sizeof(char), NULL, 0);
		fifoPush(octavesW_g__end_in__0, FIFO_Head_Init_end_octavesW___0, 24*sizeof(char), NULL, 0);
		fifoPush(sigmas__end_in__0, FIFO_Head_Init_end_sigmas__s__0, 144*sizeof(char), NULL, 0);
		// Broadcast Img
		{
			memcpy(out1__img__0+0, init_out__in__0+0, 101376*sizeof(uchar));
			memcpy(out2__end_in__0+0, init_out__in__0+0, 101376*sizeof(uchar));
		}
		sendStart(&sem_14_SSRE/*ID*/); // Core3 > Core2: Img__BuildOB__0 
		sendEnd(); // Core3 > Core2: Img__BuildOB__0 
		receiveStart(); // Core0 > Core3: Render__Render_end_g__0 
		receiveEnd(&sem_15_SSRE/*ID*/); // Core0 > Core3: Render__Render_end_g__0 
		fifoPush(out2__end_in__0, FIFO_Head_Img_end_out2__Rend__0, 101376*sizeof(char), NULL, 0);
		fifoPush(y__end_in__0, FIFO_Head_ReadYUV_end_y__Img__0, 101376*sizeof(char), NULL, 0);
		fifoPush(g__end_in__0, FIFO_Head_Render_end_g__Writ__0, 101376*sizeof(char), NULL, 0);
	}
}
