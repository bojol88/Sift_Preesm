/** 
 * @file Core1.c
 * @generated by CPrinter
 * @date Sun May 03 22:43:54 CEST 2015
 */

#include "../include/x86.h"

// Core Global Declaration
extern pthread_barrier_t iter_barrier;
extern int stopThreads;
extern char SharedMem[157560604]; //  size:= 157560604*char
extern uchar *const init_out__b__0;  // WritePGM_init_b_init_out > WritePGM_b size:= 101376*uchar defined in Core0
extern char *const WritePGM_init_g__WritePGM__0;  // WritePGM_init_g > WritePGM size:= 101376*char defined in Core0
extern sem_t sem_2_SSRE; 
extern char *const WritePGM_init_r__WritePGM__0;  // WritePGM_init_r > WritePGM size:= 101376*char defined in Core0
extern sem_t sem_3_SSRE; 
extern float *const init_out__in__1;  // sigmas_init_in_init_out > sigmas_in size:= 36*float defined in Core0
extern float *const out1__sigmas__0;  // sigmas_out1 > BuildSS_sigmas size:= 36*float defined in Core0
extern float *const out2__sigmas__0;  // sigmas_out2 > Orientation_sigmas size:= 36*float defined in Core0
extern float *const out3__end_in__0;  // sigmas_out3 > sigmas_end_out3_end_in size:= 36*float defined in Core0
extern char *const sigmas__sigmas_end_out3__0;  // sigmas > sigmas_end_out3 size:= 144*char defined in Core0
extern char *const sigmas__Orientation__0;  // sigmas > Orientation size:= 144*char defined in Core0
extern char *const sigmas__BuildSS__0;  // sigmas > BuildSS size:= 144*char defined in Core0
extern uchar *const init_out__r__0;  // WritePGM_init_r_init_out > WritePGM_r size:= 101376*uchar defined in Core0
extern uchar *const init_out__g__0;  // WritePGM_init_g_init_out > WritePGM_g size:= 101376*uchar defined in Core0

// Core Global Definitions
char *const FIFO_Head_Render_end_b__Writ__0 = (char*) (SharedMem+506880);  // FIFO_Head_Render_end_b > WritePGM_init_b size:= 101376*char
char *const FIFO_Head_Init_end_sigmas__s__0 = (char*) (SharedMem+103425484);  // FIFO_Head_Init_end_sigmas > sigmas_init_in size:= 144*char
sem_t sem_11_SSRE;
sem_t sem_12_SSRE;
sem_t sem_13_SSRE;

void *computationThread_Core1(void *arg){
	// Initialisation(s)
	fifoInit(FIFO_Head_Render_end_b__Writ__0, 101376*sizeof(char), NULL, 0);
	fifoInit(FIFO_Head_Init_end_sigmas__s__0, 144*sizeof(char), NULL, 0);
	sem_init(&sem_11_SSRE,0,0/*init_val*/); // sigmas > sigmas_end_out3
	sem_init(&sem_12_SSRE,0,0/*init_val*/); // sigmas > Orientation
	sem_init(&sem_13_SSRE,0,0/*init_val*/); // sigmas > BuildSS

	// Begin the execution loop 
	while(1){
		pthread_barrier_wait(&iter_barrier);
		if(stopThreads){
			pthread_exit(NULL);
		}
		fifoPop(init_out__b__0, FIFO_Head_Render_end_b__Writ__0, 101376*sizeof(char), NULL, 0);
		receiveStart(); // Core2 > Core1: WritePGM_init_g__WritePGM__0 
		receiveEnd(&sem_2_SSRE/*ID*/); // Core2 > Core1: WritePGM_init_g__WritePGM__0 
		receiveStart(); // Core0 > Core1: WritePGM_init_r__WritePGM__0 
		receiveEnd(&sem_3_SSRE/*ID*/); // Core0 > Core1: WritePGM_init_r__WritePGM__0 
		fifoPop(init_out__in__1, FIFO_Head_Init_end_sigmas__s__0, 144*sizeof(char), NULL, 0);
		// Broadcast sigmas
		{
			memcpy(out1__sigmas__0+0, init_out__in__1+0, 36*sizeof(float));
			memcpy(out2__sigmas__0+0, init_out__in__1+0, 36*sizeof(float));
			memcpy(out3__end_in__0+0, init_out__in__1+0, 36*sizeof(float));
		}
		sendStart(&sem_11_SSRE/*ID*/); // Core1 > Core0: sigmas__sigmas_end_out3__0 
		sendEnd(); // Core1 > Core0: sigmas__sigmas_end_out3__0 
		sendStart(&sem_12_SSRE/*ID*/); // Core1 > Core2: sigmas__Orientation__0 
		sendEnd(); // Core1 > Core2: sigmas__Orientation__0 
		sendStart(&sem_13_SSRE/*ID*/); // Core1 > Core3: sigmas__BuildSS__0 
		sendEnd(); // Core1 > Core3: sigmas__BuildSS__0 
		write_ppm(init_out__r__0,init_out__g__0,init_out__b__0,352/*w*/,288/*h*/); // WritePGM
	}
}
